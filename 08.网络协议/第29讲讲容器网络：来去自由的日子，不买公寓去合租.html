<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="format-detection" content="telephone=no">
    <style type="text/css">

#watermark {

  position: relative;
  overflow: hidden;
}

#watermark .x {
  position: absolute;
  top: 800;
  left: 400;
  color: #3300ff;
  font-size: 50px;
  pointer-events: none;
  opacity:0.5;
  filter:Alpha(opacity=50);
  -webkit-transform: rotate(45deg);
  -moz-transform: rotate(45deg);
}
    </style>


    <style type="text/css">
 html{color:#333;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-rendering:optimizelegibility;font-family:Helvetica Neue,PingFang SC,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif}html.borderbox *,html.borderbox :after,html.borderbox :before{box-sizing:border-box}article,aside,blockquote,body,button,code,dd,details,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hr,input,legend,li,menu,nav,ol,p,pre,section,td,textarea,th,ul{margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,menu,nav,section{display:block}audio,canvas,video{display:inline-block}body,button,input,select,textarea{font:300 1em/1.8 PingFang SC,Lantinghei SC,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,Helvetica,sans-serif}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}blockquote{position:relative;color:#999;font-weight:400;border-left:1px solid #1abc9c;padding-left:1em;margin:1em 3em 1em 2em}@media only screen and (max-width:640px){blockquote{margin:1em 0}}abbr,acronym{border-bottom:1px dotted;font-variant:normal}abbr{cursor:help}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:400}ol,ul{list-style:none}caption,th{text-align:left}q:after,q:before{content:""}sub,sup{font-size:75%;line-height:0;position:relative}:root sub,:root sup{vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a{color:#1abc9c}a:hover{text-decoration:underline}.typo a{border-bottom:1px solid #1abc9c}.typo a:hover{border-bottom-color:#555;color:#555}.typo a:hover,a,ins{text-decoration:none}.typo-u,u{text-decoration:underline}mark{background:#fffdd1;border-bottom:1px solid #ffedce;padding:2px;margin:0 5px}code,pre,pre tt{font-family:Courier,Courier New,monospace}pre{background:hsla(0,0%,97%,.7);border:1px solid #ddd;padding:1em 1.5em;display:block;-webkit-overflow-scrolling:touch}hr{border:none;border-bottom:1px solid #cfcfcf;margin-bottom:.8em;height:10px}.typo-small,figcaption,small{font-size:.9em;color:#888}b,strong{font-weight:700;color:#000}[draggable]{cursor:move}.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.textwrap,.textwrap td,.textwrap th{word-wrap:break-word;word-break:break-all}.textwrap-table{table-layout:fixed}.serif{font-family:Palatino,Optima,Georgia,serif}.typo-dl,.typo-form,.typo-hr,.typo-ol,.typo-p,.typo-pre,.typo-table,.typo-ul,.typo dl,.typo form,.typo hr,.typo ol,.typo p,.typo pre,.typo table,.typo ul,blockquote{margin-bottom:1rem}h1,h2,h3,h4,h5,h6{font-family:PingFang SC,Helvetica Neue,Verdana,Microsoft Yahei,Hiragino Sans GB,Microsoft Sans Serif,WenQuanYi Micro Hei,sans-serif;color:#000;line-height:1.35}.typo-h1,.typo-h2,.typo-h3,.typo-h4,.typo-h5,.typo-h6,.typo h1,.typo h2,.typo h3,.typo h4,.typo h5,.typo h6{margin-top:1.2em;margin-bottom:.6em;line-height:1.35}.typo-h1,.typo h1{font-size:2em}.typo-h2,.typo h2{font-size:1.8em}.typo-h3,.typo h3{font-size:1.6em}.typo-h4,.typo h4{font-size:1.4em}.typo-h5,.typo-h6,.typo h5,.typo h6{font-size:1.2em}.typo-ul,.typo ul{margin-left:1.3em;list-style:disc}.typo-ol,.typo ol{list-style:decimal;margin-left:1.9em}.typo-ol ol,.typo-ol ul,.typo-ul ol,.typo-ul ul,.typo li ol,.typo li ul{margin-bottom:.8em;margin-left:2em}.typo-ol ul,.typo-ul ul,.typo li ul{list-style:circle}.typo-table td,.typo-table th,.typo table caption,.typo table td,.typo table th{border:1px solid #ddd;padding:.5em 1em;color:#666}.typo-table th,.typo table th{background:#fbfbfb}.typo-table thead th,.typo table thead th{background:hsla(0,0%,95%,.7)}.typo table caption{border-bottom:none}.typo-input,.typo-textarea{-webkit-appearance:none;border-radius:0}.typo-em,.typo em,caption,legend{color:#000;font-weight:inherit}.typo-em{position:relative}.typo-em:after{position:absolute;top:.65em;left:0;width:100%;overflow:hidden;white-space:nowrap;content:"\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB\30FB"}.typo img{max-width:100%}.common-content{font-weight:400;color:#353535;line-height:1.75rem;white-space:normal;word-break:normal;font-size:1rem}.common-content img{display:block;max-width:100%;background-color:#eee}.common-content audio,.common-content video{width:100%;background-color:#eee}.common-content center,.common-content font{margin-top:1rem;display:inline-block}.common-content center{width:100%}.common-content pre{margin-top:1rem;padding-left:0;padding-right:0;position:relative;overflow:hidden}.common-content pre code{font-size:.8rem;font-family:Consolas,Liberation Mono,Menlo,monospace,Courier;display:block;width:100%;box-sizing:border-box;padding-left:1rem;padding-right:1rem;overflow-x:auto}.common-content hr{border:none;margin-top:1.5rem;margin-bottom:1.5rem;border-top:1px solid #f5f5f5;height:1px;background:none}.common-content b,.common-content h1,.common-content h2,.common-content h3,.common-content h4,.common-content h5,.common-content strong{font-weight:700}.common-content h1,.common-content h2{font-size:1.125rem;margin-bottom:.45rem}.common-content h3,.common-content h4,.common-content h5{font-size:1rem;margin-bottom:.45rem}.common-content p{font-weight:400;color:#353535;margin-top:.15rem}.common-content .orange{color:#ff5a05}.common-content .reference{font-size:1rem;color:#888}.custom-rich-content h1{margin-top:0;font-weight:400;font-size:15.25px;border-bottom:1px solid #eee;line-height:2.8}.custom-rich-content li,.custom-rich-content p{font-size:14px;color:#888;line-height:1.6}table.hljs-ln{margin-bottom:0;border-spacing:0;border-collapse:collapse}table.hljs-ln,table.hljs-ln tbody,table.hljs-ln td,table.hljs-ln tr{box-sizing:border-box}table.hljs-ln td{padding:0;border:0}table.hljs-ln td.hljs-ln-numbers{min-width:15px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;cursor:pointer;user-select:none}table.hljs-ln td.hljs-ln-code,table.hljs-ln td.hljs-ln-numbers{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px;line-height:20px;vertical-align:top}table.hljs-ln td.hljs-ln-code{position:relative;padding-right:10px;padding-left:10px;overflow:visible;color:#24292e;word-wrap:normal;white-space:pre}video::-webkit-media-controls{overflow:hidden!important}video::-webkit-media-controls-enclosure{width:calc(100% + 32px);margin-left:auto}.button-cancel{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel,.button-primary{-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary{color:#fff;background-color:#ff5a05;border-radius:3px}@font-face{font-family:iconfont;src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot);src:url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.woff) format("woff"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.ttf) format("truetype"),url(//at.alicdn.com/t/font_372689_bwwwtosxtzp.svg#iconfont) format("svg")}@font-face{font-family:player-font;src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot);src:url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.eot#iefix) format("embedded-opentype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.woff) format("woff"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.ttf) format("truetype"),url(//at.alicdn.com/t/font_509397_1cyjv4o90qiod2t9.svg#player-font) format("svg")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-webkit-text-stroke-width:.2px;-moz-osx-font-smoothing:grayscale}html{background:#fff;min-height:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{width:100%}body.fixed{overflow:hidden;position:fixed;width:100vw;height:100vh}i{font-style:normal}a{word-wrap:break-word;-webkit-tap-highlight-color:rgba(0,0,0,0)}a:hover{text-decoration:none}.fade-enter-active,.fade-leave-active{transition:opacity .3s}.fade-enter,.fade-leave-to{opacity:0}.MathJax,.MathJax_CHTML,.MathJax_MathContainer,.MathJax_MathML,.MathJax_PHTML,.MathJax_PlainSource,.MathJax_SVG{outline:0}.ios-app-switch .js-audit{display:none}._loading_wrap_{position:fixed;width:100vw;height:100vh;top:50%;left:50%;transform:translate(-50%,-50%);z-index:999}._loading_div_class_,._loading_wrap_{display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center}._loading_div_class_{word-wrap:break-word;padding:.5rem .75rem;text-align:center;z-index:9999;font-size:.6rem;max-width:60%;color:#fff;border-radius:.25rem;-ms-flex-direction:column;flex-direction:column}._loading_div_class_ .message{color:#353535;font-size:16px;line-height:3}.spinner{animation:circle-rotator 1.4s linear infinite}.spinner *{line-height:0;box-sizing:border-box}@keyframes circle-rotator{0%{transform:rotate(0deg)}to{transform:rotate(270deg)}}.path{stroke-dasharray:187;stroke-dashoffset:0;transform-origin:center;animation:circle-dash 1.4s ease-in-out infinite,circle-colors 5.6s ease-in-out infinite}@keyframes circle-colors{0%{stroke:#ff5a05}to{stroke:#ff5a05}}@keyframes circle-dash{0%{stroke-dashoffset:187}50%{stroke-dashoffset:46.75;transform:rotate(135deg)}to{stroke-dashoffset:187;transform:rotate(450deg)}}.confirm-box-wrapper,.confirm-box-wrapper .mask{position:absolute;top:0;left:0;right:0;bottom:0}.confirm-box-wrapper .mask{background:rgba(0,0,0,.6)}.confirm-box-wrapper .confirm-box{position:fixed;top:50%;left:50%;width:267px;background:#fff;transform:translate(-50%,-50%);border-radius:7px}.confirm-box-wrapper .confirm-box .head{margin:0 18px;font-size:18px;text-align:center;line-height:65px;border-bottom:1px solid #d9d9d9}.confirm-box-wrapper .confirm-box .body{padding:18px;padding-bottom:0;color:#353535;font-size:12.5px;max-height:150px;overflow:auto}.confirm-box-wrapper .confirm-box .foot{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;padding:18px}.confirm-box-wrapper .confirm-box .foot .button-cancel{border:1px solid #d9d9d9}.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}




    </style>
    <style type="text/css">
        .button-cancel[data-v-87ffcada]{color:#888;border:1px solid #888;border-radius:3px;margin-right:12px}.button-cancel[data-v-87ffcada],.button-primary[data-v-87ffcada]{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;height:35px;display:inline-block;font-size:15px;text-align:center;line-height:36px}.button-primary[data-v-87ffcada]{color:#fff;background-color:#ff5a05;border-radius:3px}.pd[data-v-87ffcada]{padding-left:1.375rem;padding-right:1.375rem}.article[data-v-87ffcada]{max-width:70rem;margin:0 auto}.article .article-unavailable[data-v-87ffcada]{color:#fa8919;font-size:15px;font-weight:600;line-height:24px;border-radius:5px;padding:12px;background-color:#f6f7fb;margin-top:20px}.article .article-unavailable .iconfont[data-v-87ffcada]{font-size:12px}.article .main[data-v-87ffcada]{padding:1.25rem 0;margin-bottom:52px}.article-title[data-v-87ffcada]{color:#353535;font-weight:400;line-height:1.65rem;font-size:1.34375rem}.article-info[data-v-87ffcada]{color:#888;font-size:.9375rem;margin-top:1.0625rem}.article-content[data-v-87ffcada]{margin-top:1.0625rem}.article-content.android video[data-v-87ffcada]::-webkit-media-controls-fullscreen-button{display:none}.copyright[data-v-87ffcada]{color:#b2b2b2;padding-bottom:20px;margin-top:20px;font-size:13px}.audio-player[data-v-87ffcada]{width:100%;margin:20px 0}.to-comment[data-v-87ffcada]{overflow:hidden;padding-top:10px;margin-bottom:-30px}.to-comment a.button-primary[data-v-87ffcada]{float:right;height:20px;font-size:12px;line-height:20px;padding:4px 8px;cursor:pointer}.article-comments[data-v-87ffcada]{margin-top:2rem}.article-comments h2[data-v-87ffcada]{text-align:center;color:#888;position:relative;z-index:1;margin-bottom:1rem}.article-comments h2[data-v-87ffcada]:before{border-top:1px dotted #888;content:"";position:absolute;top:56%;left:0;width:100%;z-index:-1}.article-comments h2 span[data-v-87ffcada]{font-size:15.25px;font-weight:400;padding:0 1rem;background:#fff;display:inline-block}.article-sub-bottom[data-v-87ffcada]{z-index:10;cursor:pointer}.switch-btns[data-v-87ffcada]{height:76px;cursor:pointer;padding-top:24px;padding-bottom:24px;border-bottom:10px solid #f6f7fb;position:relative}.switch-btns[data-v-87ffcada]:before{content:" ";height:1px;background:#e8e8e8;position:absolute;top:0;left:0;-webkit-box-sizing:border-box;box-sizing:border-box;left:1.375rem;right:1.375rem}.switch-btns .btn[data-v-87ffcada]{height:38px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.switch-btns .btn .tag[data-v-87ffcada]{-webkit-box-flex:0;-ms-flex:0 0 62px;flex:0 0 62px;text-align:center;color:#888;font-size:14px;border-radius:10px;height:22px;line-height:22px;background:#f6f7fb;font-weight:400}.switch-btns .btn .txt[data-v-87ffcada]{margin-left:10px;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;color:#888;font-size:15px;height:22px;line-height:22px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:400}@media (max-width:769px){.article .breadcrumb[data-v-87ffcada]{padding-top:10px;padding-bottom:10px}}





    </style>

    <style type="text/css">
        .comment-item{list-style-position:inside;width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;margin-bottom:1rem}.comment-item a{border-bottom:none}.comment-item .avatar{width:2.625rem;height:2.625rem;-ms-flex-negative:0;flex-shrink:0;border-radius:50%}.comment-item .info{margin-left:.5rem;-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1}.comment-item .info .hd{width:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .username{color:#888;font-size:15.25px;font-weight:400;line-height:1.2}.comment-item .info .hd .control{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.comment-item .info .hd .control .btn-share{color:#888;font-size:.75rem;margin-right:1rem}.comment-item .info .hd .control .btn-praise{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:15.25px;text-decoration:none}.comment-item .info .hd .control .btn-praise i{color:#888;display:inline-block;font-size:.75rem;margin-right:.3rem;margin-top:-.01rem}.comment-item .info .hd .control .btn-praise i.on,.comment-item .info .hd .control .btn-praise span{color:#ff5a05}.comment-item .info .bd{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all;line-height:1.6}.comment-item .info .time{color:#888;font-size:9px;line-height:1}.comment-item .info .reply .reply-hd{font-size:15.25px}.comment-item .info .reply .reply-hd span{margin-left:-12px;color:#888;font-weight:400}.comment-item .info .reply .reply-hd i{color:#ff5a05;font-size:15.25px}.comment-item .info .reply .reply-content{color:#353535;font-size:15.25px;font-weight:400;white-space:normal;word-break:break-all}.comment-item .info .reply .reply-time{color:#888;font-size:9px}




    </style>
</head>
<body>
<div id="app">


    <div data-v-87ffcada="" class="article" id="watermark">
        <p class="x">æ‰€æœ‰æœ€æ–°æå®¢æ—¶é—´è¯¾ç¨‹è¯·åŠ QQç¾¤170701297</p>
        <div data-v-87ffcada="" class="main main-app">
            <h1 data-v-87ffcada="" class="article-title pd">
                ç¬¬29è®²è®²å®¹å™¨ç½‘ç»œï¼šæ¥å»è‡ªç”±çš„æ—¥å­ï¼Œä¸ä¹°å…¬å¯“å»åˆç§Ÿ
            </h1>
            <div data-v-87ffcada="" class="article-content typo common-content pd"><img data-v-87ffcada=""
                                                                                        src="https://static001.geekbang.org/resource/image/7a/45/7aaea6279f6e1aeeda8cb33899327245.jpg">


                <div data-v-87ffcada="" id="article-content" class="">
                    <div class="text">
                        <p>å¦‚æœè¯´è™šæ‹Ÿæœºæ˜¯ä¹°å…¬å¯“ï¼Œå®¹å™¨åˆ™ç›¸å½“äºåˆç§Ÿï¼Œæœ‰ä¸€å®šçš„éš”ç¦»ï¼Œä½†æ˜¯éš”ç¦»æ€§æ²¡æœ‰é‚£ä¹ˆå¥½ã€‚äº‘è®¡ç®—è§£å†³äº†åŸºç¡€èµ„æºå±‚çš„å¼¹æ€§ä¼¸ç¼©ï¼Œå´æ²¡æœ‰è§£å†³PaaSå±‚åº”ç”¨éšåŸºç¡€èµ„æºå±‚å¼¹æ€§ä¼¸ç¼©è€Œå¸¦æ¥çš„æ‰¹é‡ã€å¿«é€Ÿéƒ¨ç½²é—®é¢˜ã€‚äºæ˜¯ï¼Œå®¹å™¨åº”è¿è€Œç”Ÿã€‚</p>
<p>å®¹å™¨å°±æ˜¯Containerï¼Œè€ŒContainerçš„å¦ä¸€ä¸ªæ„æ€æ˜¯é›†è£…ç®±ã€‚å…¶å®<strong>å®¹å™¨çš„æ€æƒ³å°±æ˜¯è¦å˜æˆè½¯ä»¶äº¤ä»˜çš„é›†è£…ç®±</strong>ã€‚é›†è£…ç®±çš„ç‰¹ç‚¹ï¼Œä¸€æ˜¯æ‰“åŒ…ï¼ŒäºŒæ˜¯æ ‡å‡†ã€‚</p>
<p><img src="https://static001.geekbang.org/resource/image/a5/dc/a50157f1084c946b9e27f3b328b8d2dc.jpg" alt="" /></p>
<p>åœ¨æ²¡æœ‰é›†è£…ç®±çš„æ—¶ä»£ï¼Œå‡è®¾è¦å°†è´§ç‰©ä»Aè¿åˆ°Bï¼Œä¸­é—´è¦ç»è¿‡ä¸‰ä¸ªç å¤´ã€æ¢ä¸‰æ¬¡èˆ¹ã€‚æ¯æ¬¡éƒ½è¦å°†è´§ç‰©å¸ä¸‹èˆ¹æ¥ï¼Œå¼„çš„ä¹±ä¸ƒå…«ç³Ÿï¼Œç„¶åè¿˜è¦å†æ¬ä¸Šèˆ¹é‡æ–°æ•´é½æ‘†å¥½ã€‚å› æ­¤åœ¨æ²¡æœ‰é›†è£…ç®±çš„æ—¶å€™ï¼Œæ¯æ¬¡æ¢èˆ¹ï¼Œèˆ¹å‘˜ä»¬éƒ½è¦åœ¨å²¸ä¸Šå¾…å‡ å¤©æ‰èƒ½å¹²å®Œæ´»ã€‚</p>
<p>æœ‰äº†å°ºå¯¸å…¨éƒ¨éƒ½ä¸€æ ·çš„é›†è£…ç®±ä»¥åï¼Œå¯ä»¥æŠŠæ‰€æœ‰çš„è´§ç‰©éƒ½æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œæ‰€ä»¥æ¯æ¬¡æ¢èˆ¹çš„æ—¶å€™ï¼Œä¸€ä¸ªç®±å­æ•´ä½“æ¬è¿‡å»å°±è¡Œäº†ï¼Œå°æ—¶çº§åˆ«å°±èƒ½å®Œæˆï¼Œèˆ¹å‘˜å†ä¹Ÿä¸ç”¨è€—è´¹å¾ˆé•¿æ—¶é—´äº†ã€‚è¿™æ˜¯é›†è£…ç®±çš„â€œæ‰“åŒ…â€â€œæ ‡å‡†â€ä¸¤å¤§ç‰¹ç‚¹åœ¨ç”Ÿæ´»ä¸­çš„åº”ç”¨ã€‚</p>
<p><img src="https://static001.geekbang.org/resource/image/50/cb/50c12f33ec178972c315e57b370dffcb.jpg" alt="" /></p>
<p>é‚£ä¹ˆå®¹å™¨å¦‚ä½•å¯¹åº”ç”¨æ‰“åŒ…å‘¢ï¼Ÿ</p>
<p>å­¦ä¹ é›†è£…ç®±ï¼Œé¦–å…ˆè¦æœ‰ä¸ªå°é—­çš„ç¯å¢ƒï¼Œå°†è´§ç‰©å°è£…èµ·æ¥ï¼Œè®©è´§ç‰©ä¹‹é—´äº’ä¸å¹²æ‰°ï¼Œäº’ç›¸éš”ç¦»ï¼Œè¿™æ ·è£…è´§å¸è´§æ‰æ–¹ä¾¿ã€‚</p>
<p>å°é—­çš„ç¯å¢ƒä¸»è¦ä½¿ç”¨äº†ä¸¤ç§æŠ€æœ¯ï¼Œä¸€ç§æ˜¯<strong>çœ‹èµ·æ¥æ˜¯éš”ç¦»çš„æŠ€æœ¯</strong>ï¼Œç§°ä¸º<strong>namespace</strong>ï¼Œä¹Ÿå³æ¯ä¸ª namespaceä¸­çš„åº”ç”¨çœ‹åˆ°çš„æ˜¯ä¸åŒçš„ IPåœ°å€ã€ç”¨æˆ·ç©ºé—´ã€ç¨‹å·ç­‰ã€‚å¦ä¸€ç§æ˜¯<strong>ç”¨èµ·æ¥æ˜¯éš”ç¦»çš„æŠ€æœ¯</strong>ï¼Œç§°ä¸º<strong>cgroup</strong>ï¼Œä¹Ÿå³æ˜æ˜æ•´å°æœºå™¨æœ‰å¾ˆå¤šçš„ CPUã€å†…å­˜ï¼Œè€Œä¸€ä¸ªåº”ç”¨åªèƒ½ç”¨å…¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚</p><!-- [[[read_end]]] -->
<p>æœ‰äº†è¿™ä¸¤é¡¹æŠ€æœ¯ï¼Œå°±ç›¸å½“äºæˆ‘ä»¬ç„Šå¥½äº†é›†è£…ç®±ã€‚æ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯å¦‚ä½•â€œå°†è¿™ä¸ªé›†è£…ç®±æ ‡å‡†åŒ–â€ï¼Œå¹¶åœ¨å“ªè‰˜èˆ¹ä¸Šéƒ½èƒ½è¿è¾“ã€‚è¿™é‡Œçš„æ ‡å‡†é¦–å…ˆå°±æ˜¯<strong>é•œåƒ</strong>ã€‚</p>
<p>æ‰€è°“é•œåƒï¼Œå°±æ˜¯å°†ä½ ç„Šå¥½é›†è£…ç®±çš„é‚£ä¸€åˆ»ï¼Œå°†é›†è£…ç®±çš„çŠ¶æ€ä¿å­˜ä¸‹æ¥ï¼Œå°±åƒå­™æ‚Ÿç©ºè¯´ï¼šâ€œå®šï¼â€ï¼Œé›†è£…ç®±é‡Œçš„çŠ¶æ€å°±è¢«å®šåœ¨äº†é‚£ä¸€åˆ»ï¼Œç„¶åå°†è¿™ä¸€åˆ»çš„çŠ¶æ€ä¿å­˜æˆä¸€ç³»åˆ—æ–‡ä»¶ã€‚æ— è®ºä»å“ªé‡Œè¿è¡Œè¿™ä¸ªé•œåƒï¼Œéƒ½èƒ½å®Œæ•´åœ°è¿˜åŸå½“æ—¶çš„æƒ…å†µã€‚</p>
<p><img src="https://static001.geekbang.org/resource/image/ad/9d/ad59fa4271e5dd7b40588a2dfeb6f79d.jpg" alt="" /></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±å…·ä½“æ¥çœ‹çœ‹ï¼Œè¿™ä¸¤ç§ç½‘ç»œæ–¹é¢çš„æ‰“åŒ…æŠ€æœ¯ã€‚</p>
<h2>å‘½åç©ºé—´ï¼ˆnamespaceï¼‰</h2>
<p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ç½‘ç»œnamespaceã€‚</p>
<p>namespaceç¿»è¯‘è¿‡æ¥å°±æ˜¯å‘½åç©ºé—´ã€‚å…¶å®å¾ˆå¤šé¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡è¯­è¨€é‡Œé¢ï¼Œéƒ½æœ‰å‘½åç©ºé—´è¿™ä¸ªä¸œè¥¿ã€‚å¤§å®¶ä¸€èµ·å†™ä»£ç ï¼Œéš¾å…ç±»ä¼šèµ·ç›¸åŒçš„åè¯ï¼Œç¼–è¯‘å°±ä¼šå†²çªã€‚è€Œæ¯ä¸ªåŠŸèƒ½éƒ½æœ‰è‡ªå·±çš„å‘½åç©ºé—´ï¼Œåœ¨ä¸åŒçš„ç©ºé—´é‡Œé¢ï¼Œç±»åç›¸åŒï¼Œä¸ä¼šå†²çªã€‚</p>
<p>åœ¨Linuxä¸‹ä¹Ÿæ˜¯è¿™æ ·çš„ï¼Œå¾ˆå¤šçš„èµ„æºéƒ½æ˜¯å…¨å±€çš„ã€‚æ¯”å¦‚è¿›ç¨‹æœ‰å…¨å±€çš„è¿›ç¨‹IDï¼Œç½‘ç»œä¹Ÿæœ‰å…¨å±€çš„è·¯ç”±è¡¨ã€‚ä½†æ˜¯ï¼Œå½“ä¸€å°Linuxä¸Šè·‘å¤šä¸ªè¿›ç¨‹çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬è§‰å¾—ä½¿ç”¨ä¸åŒçš„è·¯ç”±ç­–ç•¥ï¼Œè¿™äº›è¿›ç¨‹å¯èƒ½ä¼šå†²çªï¼Œé‚£å°±éœ€è¦å°†è¿™ä¸ªè¿›ç¨‹æ”¾åœ¨ä¸€ä¸ªç‹¬ç«‹çš„namespaceé‡Œé¢ï¼Œè¿™æ ·å°±å¯ä»¥ç‹¬ç«‹é…ç½®ç½‘ç»œäº†ã€‚</p>
<p>ç½‘ç»œçš„namespaceç”±ip netnså‘½ä»¤æ“ä½œã€‚å®ƒå¯ä»¥åˆ›å»ºã€åˆ é™¤ã€æŸ¥è¯¢namespaceã€‚</p>
<p>æˆ‘ä»¬å†æ¥çœ‹å°†ä½ ä»¬å®¿èˆæ”¾è¿›ä¸€å°ç‰©ç†æœºçš„é‚£ä¸ªå›¾ã€‚ä½ ä»¬å®¿èˆé•¿çš„ç”µè„‘æ˜¯ä¸€å°è·¯ç”±å™¨ï¼Œä½ ç°åœ¨åº”è¯¥çŸ¥é“æ€ä¹ˆå®ç°è¿™ä¸ªè·¯ç”±å™¨å§ï¼Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªRouterè™šæ‹Ÿæœºæ¥åšè¿™ä»¶äº‹æƒ…ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªæ›´åŠ ç®€å•çš„åŠæ³•ï¼Œå°±æ˜¯æˆ‘åœ¨å›¾é‡Œç”»çš„è¿™æ¡è™šçº¿ï¼Œè¿™ä¸ªå°±æ˜¯é€šè¿‡namespaceå®ç°çš„ã€‚</p>
<p><img src="https://static001.geekbang.org/resource/image/1a/1a/1a5d299c2eb5480eda93a8f8e3b3ca1a.jpg" alt="" /></p>
<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªrouternsï¼Œäºæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç½‘ç»œç©ºé—´å°±äº§ç”Ÿäº†ã€‚ä½ å¯ä»¥åœ¨é‡Œé¢å°½æƒ…è®¾ç½®è‡ªå·±çš„è§„åˆ™ã€‚</p>
<pre><code>ip netns add routerns
</code></pre>
<p>æ—¢ç„¶æ˜¯è·¯ç”±å™¨ï¼Œè‚¯å®šè¦èƒ½è½¬å‘å˜›ï¼Œå› è€Œforwardå¼€å…³è¦æ‰“å¼€ã€‚</p>
<pre><code>ip netns exec routerns sysctl -w net.ipv4.ip_forward=1
</code></pre>
<p>execçš„æ„æ€å°±æ˜¯è¿›å…¥è¿™ä¸ªç½‘ç»œç©ºé—´åšç‚¹äº‹æƒ…ã€‚åˆå§‹åŒ–ä¸€ä¸‹iptablesï¼Œå› ä¸ºè¿™é‡Œé¢è¦é…ç½®NATè§„åˆ™ã€‚</p>
<pre><code>ip netns exec routerns iptables-save -c 
ip netns exec routerns iptables-restore -c
</code></pre>
<p>è·¯ç”±å™¨éœ€è¦æœ‰ä¸€å¼ ç½‘å¡è¿åˆ°br0ä¸Šï¼Œå› è€Œè¦åˆ›å»ºä¸€ä¸ªç½‘å¡ã€‚</p>
<pre><code>ovs-vsctl -- add-port br0 taprouter -- set Interface taprouter type=internal -- set Interface taprouter external-ids:iface-status=active -- set Interface taprouter external-ids:attached-mac=fa:16:3e:84:6e:cc
</code></pre>
<p>è¿™ä¸ªç½‘ç»œåˆ›å»ºå®Œäº†ï¼Œä½†æ˜¯æ˜¯åœ¨namespaceå¤–é¢çš„ï¼Œå¦‚ä½•è¿›å»å‘¢ï¼Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªå‘½ä»¤ï¼š</p>
<pre><code>ip link set taprouter netns routerns
</code></pre>
<p>è¦ç»™è¿™ä¸ªç½‘å¡é…ç½®ä¸€ä¸ªIPåœ°å€ï¼Œå½“ç„¶åº”è¯¥æ˜¯è™šæ‹Ÿæœºç½‘ç»œçš„ç½‘å…³åœ°å€ã€‚ä¾‹å¦‚è™šæ‹Ÿæœºç§ç½‘ç½‘æ®µä¸º192.168.1.0/24ï¼Œç½‘å…³çš„åœ°å€å¾€å¾€ä¸º192.168.1.1ã€‚</p>
<pre><code>ip netns exec routerns ip -4 addr add 192.168.1.1/24 brd 192.168.1.255 scope global dev taprouter
</code></pre>
<p>ä¸ºäº†è®¿é—®å¤–ç½‘ï¼Œè¿˜éœ€è¦å¦ä¸€ä¸ªç½‘å¡è¿åœ¨å¤–ç½‘ç½‘æ¡¥br-exä¸Šï¼Œå¹¶ä¸”å¡åœ¨namespaceé‡Œé¢ã€‚</p>
<pre><code>ovs-vsctl -- add-port br-ex taprouterex -- set Interface taprouterex type=internal -- set Interface taprouterex external-ids:iface-status=active -- set Interface taprouterex external-ids:attached-mac=fa:16:3e:68:12:c0
</code></pre>
<pre><code>ip link set taprouterex netns routerns
</code></pre>
<p>æˆ‘ä»¬è¿˜éœ€è¦ä¸ºè¿™ä¸ªç½‘å¡åˆ†é…ä¸€ä¸ªåœ°å€ï¼Œè¿™ä¸ªåœ°å€åº”è¯¥å’Œç‰©ç†å¤–ç½‘ç½‘ç»œåœ¨ä¸€ä¸ªç½‘æ®µã€‚å‡è®¾ç‰©ç†å¤–ç½‘ä¸º16.158.1.0/24ï¼Œå¯ä»¥åˆ†é…ä¸€ä¸ªå¤–ç½‘åœ°å€16.158.1.100/24ã€‚</p>
<pre><code>ip netns exec routerns ip -4 addr add 16.158.1.100/24 brd 16.158.1.255 scope global dev taprouterex
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œæ—¢ç„¶æ˜¯è·¯ç”±å™¨ï¼Œå°±éœ€è¦é…ç½®è·¯ç”±è¡¨ï¼Œè·¯ç”±è¡¨æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code>ip netns exec routerns route -n
Kernel IP routing table
Destination   Gateway     Genmask     Flags Metric Ref  Use Iface
0.0.0.0     16.158.1.1  0.0.0.0     UG  0   0    0 taprouterex
192.168.1.0    0.0.0.0     255.255.255.0  U   0   0    0 taprouter
16.158.1.0  0.0.0.0     255.255.255.0  U   0   0    0 taprouterex
</code></pre>
<p>è·¯ç”±è¡¨ä¸­çš„é»˜è®¤è·¯ç”±æ˜¯å»ç‰©ç†å¤–ç½‘çš„ï¼Œå»192.168.1.0/24ä¹Ÿå³è™šæ‹Ÿæœºç§ç½‘ï¼Œèµ°ä¸‹é¢çš„ç½‘å¡ï¼Œå»16.158.1.0/24ä¹Ÿå³ç‰©ç†å¤–ç½‘ï¼Œèµ°ä¸Šé¢çš„ç½‘å¡ã€‚</p>
<p>æˆ‘ä»¬åœ¨å‰é¢çš„ç« èŠ‚è®²è¿‡ï¼Œå¦‚æœè¦åœ¨è™šæ‹Ÿæœºé‡Œé¢æä¾›æœåŠ¡ï¼Œæä¾›ç»™å¤–ç½‘çš„å®¢æˆ·ç«¯è®¿é—®ï¼Œå®¢æˆ·ç«¯éœ€è¦è®¿é—®å¤–ç½‘IP3ï¼Œä¼šåœ¨å¤–ç½‘ç½‘å£NATç§°ä¸ºè™šæ‹Ÿæœºç§ç½‘IPã€‚è¿™ä¸ªNATè§„åˆ™è¦åœ¨è¿™ä¸ªnamespaceé‡Œé¢é…ç½®ã€‚</p>
<pre><code>ip netns exec routerns iptables -t nat -nvL
Chain PREROUTING
target  prot opt  in  out  source  destination
DNAT  all  --  *  *  0.0.0.0/0 16.158.1.103 to:192.168.1.3
Chain POSTROUTING
target  prot opt  in  out  source   destination
SNAT  all  --  *  *  192.168.1.3  0.0.0.0/0 to:16.158.1.103
</code></pre>
<p>è¿™é‡Œé¢æœ‰ä¸¤ä¸ªè§„åˆ™ï¼Œä¸€ä¸ªæ˜¯SNATï¼Œå°†è™šæ‹Ÿæœºçš„ç§ç½‘IP 192.168.1.3 NATæˆç‰©ç†å¤–ç½‘IP 16.158.1.103ã€‚ä¸€ä¸ªæ˜¯DNATï¼Œå°†ç‰©ç†å¤–ç½‘IP 16.158.1.103 NATæˆè™šæ‹Ÿæœºç§ç½‘IP 192.168.1.3ã€‚</p>
<p>è‡³æ­¤ä¸ºæ­¢ï¼ŒåŸºäºç½‘ç»œnamespaceçš„è·¯ç”±å™¨å®ç°å®Œæ¯•ã€‚</p>
<h2>æœºåˆ¶ç½‘ç»œï¼ˆcgroupï¼‰</h2>
<p>æˆ‘ä»¬å†æ¥çœ‹æ‰“åŒ…çš„å¦ä¸€ä¸ªæœºåˆ¶ç½‘ç»œcgroupã€‚</p>
<p>cgroupå…¨ç§°control groupsï¼Œæ˜¯Linuxå†…æ ¸æä¾›çš„ä¸€ç§å¯ä»¥é™åˆ¶ã€éš”ç¦»è¿›ç¨‹ä½¿ç”¨çš„èµ„æºæœºåˆ¶ã€‚</p>
<p>cgroupèƒ½æ§åˆ¶å“ªäº›èµ„æºå‘¢ï¼Ÿå®ƒæœ‰å¾ˆå¤šå­ç³»ç»Ÿï¼š</p>
<ul>
<li>
<p>CPUå­ç³»ç»Ÿä½¿ç”¨è°ƒåº¦ç¨‹åºä¸ºè¿›ç¨‹æ§åˆ¶CPUçš„è®¿é—®ï¼›</p>
</li>
<li>
<p>cpusetï¼Œå¦‚æœæ˜¯å¤šæ ¸å¿ƒçš„CPUï¼Œè¿™ä¸ªå­ç³»ç»Ÿä¼šä¸ºè¿›ç¨‹åˆ†é…å•ç‹¬çš„CPUå’Œå†…å­˜ï¼›</p>
</li>
<li>
<p>memoryå­ç³»ç»Ÿï¼Œè®¾ç½®è¿›ç¨‹çš„å†…å­˜é™åˆ¶ä»¥åŠäº§ç”Ÿå†…å­˜èµ„æºæŠ¥å‘Šï¼›</p>
</li>
<li>
<p>blkioå­ç³»ç»Ÿï¼Œè®¾ç½®é™åˆ¶æ¯ä¸ªå—è®¾å¤‡çš„è¾“å…¥è¾“å‡ºæ§åˆ¶ï¼›</p>
</li>
<li>
<p>net_clsï¼Œè¿™ä¸ªå­ç³»ç»Ÿä½¿ç”¨ç­‰çº§è¯†åˆ«ç¬¦ï¼ˆclassidï¼‰æ ‡è®°ç½‘ç»œæ•°æ®åŒ…ï¼Œå¯å…è®¸Linux æµé‡æ§åˆ¶ç¨‹åºï¼ˆtcï¼‰è¯†åˆ«ä»å…·ä½“cgroupä¸­ç”Ÿæˆçš„æ•°æ®åŒ…ã€‚</p>
</li>
</ul>
<p>æˆ‘ä»¬è¿™é‡Œæœ€å…³å¿ƒçš„æ˜¯net_clsï¼Œå®ƒå¯ä»¥å’Œå‰é¢è®²è¿‡çš„TCå…³è”èµ·æ¥ã€‚</p>
<p>cgroupæä¾›äº†ä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œä½œä¸ºè¿›è¡Œåˆ†ç»„ç®¡ç†å’Œå„å­ç³»ç»Ÿè®¾ç½®çš„ç”¨æˆ·æ¥å£ã€‚è¦ä½¿ç”¨cgroupï¼Œå¿…é¡»æŒ‚è½½cgroupæ–‡ä»¶ç³»ç»Ÿï¼Œä¸€èˆ¬æƒ…å†µä¸‹éƒ½æ˜¯æŒ‚è½½åˆ°/sys/fs/cgroupç›®å½•ä¸‹ã€‚</p>
<p>æ‰€ä»¥é¦–å…ˆæˆ‘ä»¬è¦æŒ‚è½½ä¸€ä¸ªnet_clsçš„æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<pre><code>mkdir /sys/fs/cgroup/net_cls
mount -t cgroup -onet_cls net_cls /sys/fs/cgroup/net_cls
</code></pre>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦é…ç½®TCäº†ã€‚è¿˜è®°å¾—å’±ä»¬å®éªŒTCçš„æ—¶å€™é‚£ä¸ªæ ‘å—ï¼Ÿ</p>
<p><img src="https://static001.geekbang.org/resource/image/9a/b5/9a1b8a7c0c5403a2b4b3c277545991b5.jpg" alt="" /></p>
<p>å½“æ—¶æˆ‘ä»¬é€šè¿‡è¿™ä¸ªå‘½ä»¤è®¾å®šäº†è§„åˆ™ï¼šä»1.2.3.4æ¥çš„ï¼Œå‘é€ç»™port 80çš„åŒ…ï¼Œä»1:10èµ°ï¼›å…¶ä»–ä»1.2.3.4å‘é€æ¥çš„åŒ…ä»1:11èµ°ï¼›å…¶ä»–çš„èµ°é»˜è®¤ã€‚</p>
<pre><code>tc filter add dev eth0 protocol ip parent 1:0 prio 1 u32 match ip src 1.2.3.4 match ip dport 80 0xffff flowid 1:10
tc filter add dev eth0 protocol ip parent 1:0 prio 1 u32 match ip src 1.2.3.4 flowid 1:11
</code></pre>
<p>è¿™é‡Œæ˜¯æ ¹æ®æºIPæ¥è®¾å®šçš„ï¼Œç°åœ¨æœ‰äº†cgroupï¼Œæˆ‘ä»¬æŒ‰ç…§cgroupå†æ¥è®¾å®šè§„åˆ™ã€‚</p>
<pre><code>tc filter add dev eth0 protocol ip parent 1:0 prio 1 handle 1: cgroup
</code></pre>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªç”¨æˆ·aå’Œbï¼Œè¦å¯¹å®ƒä»¬è¿›è¡Œå¸¦å®½é™åˆ¶ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸¤ä¸ªnet_clsã€‚</p>
<pre><code>mkdir /sys/fs/cgroup/net_cls/a   
mkdir /sys/fs/cgroup/net_cls/b
</code></pre>
<p>å‡è®¾ç”¨æˆ·aå¯åŠ¨çš„è¿›ç¨‹IDä¸º12345ï¼ŒæŠŠå®ƒæ”¾åœ¨net_cls/a/tasksæ–‡ä»¶ä¸­ã€‚åŒæ ·å‡è®¾ç”¨æˆ·bå¯åŠ¨çš„è¿›ç¨‹IDä¸º12346ï¼ŒæŠŠå®ƒæ”¾åœ¨net_cls/b/tasksæ–‡ä»¶ä¸­ã€‚</p>
<p>net_cls/aç›®å½•ä¸‹é¢ï¼Œè¿˜æœ‰ä¸€ä¸ªæ–‡ä»¶net_cls.classidï¼Œæˆ‘ä»¬æ”¾flowid 1:10ã€‚net_cls/bç›®å½•ä¸‹é¢ï¼Œä¹Ÿåˆ›å»ºä¸€ä¸ªæ–‡ä»¶net_cls.classidï¼Œæˆ‘ä»¬æ”¾flowid 1:11ã€‚</p>
<p>è¿™ä¸ªæ•°å­—æ€ä¹ˆæ”¾å‘¢ï¼Ÿè¦è½¬æ¢æˆä¸€ä¸ª0xAAAABBBBçš„å€¼ï¼ŒAAAAå¯¹åº”classä¸­å†’å·å‰é¢çš„æ•°å­—ï¼Œè€ŒBBBBå¯¹åº”åé¢çš„æ•°å­—ã€‚</p>
<pre><code>echo 0x00010010 &gt; /sys/fs/cgroup/net_cls/a/net_cls.classid    
echo 0x00010011 &gt; /sys/fs/cgroup/net_cls/b/net_cls.classid
</code></pre>
<p>è¿™æ ·ç”¨æˆ·açš„è¿›ç¨‹å‘çš„åŒ…ï¼Œä¼šæ‰“ä¸Š1:10è¿™ä¸ªæ ‡ç­¾ï¼›ç”¨æˆ·bçš„è¿›ç¨‹å‘çš„åŒ…ï¼Œä¼šæ‰“ä¸Š1:11è¿™ä¸ªæ ‡ç­¾ã€‚ç„¶åTCæ ¹æ®è¿™ä¸¤ä¸ªæ ‡ç­¾ï¼Œè®©ç”¨æˆ·açš„è¿›ç¨‹çš„åŒ…èµ°å·¦è¾¹çš„åˆ†æ”¯ï¼Œç”¨æˆ·bçš„è¿›ç¨‹çš„åŒ…èµ°å³è¾¹çš„åˆ†æ”¯ã€‚</p>
<h2>å®¹å™¨ç½‘ç»œä¸­å¦‚ä½•èå…¥ç‰©ç†ç½‘ç»œï¼Ÿ</h2>
<p>äº†è§£äº†å®¹å™¨èƒŒåçš„æŠ€æœ¯ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ï¼Œå®¹å™¨ç½‘ç»œç©¶ç«Ÿæ˜¯å¦‚ä½•èå…¥ç‰©ç†ç½‘ç»œçš„ï¼Ÿ</p>
<p>å¦‚æœä½ ä½¿ç”¨docker runè¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°è¿™æ ·ä¸€ä¸ªæ‹“æ‰‘ç»“æ„ã€‚</p>
<p><img src="https://static001.geekbang.org/resource/image/20/d2/20e87bc215b9d049a4a504d775d26dd2.jpg" alt="" /></p>
<p>æ˜¯ä¸æ˜¯å’Œè™šæ‹Ÿæœºå¾ˆåƒï¼Ÿå®¹å™¨é‡Œé¢æœ‰å¼ ç½‘å¡ï¼Œå®¹å™¨å¤–æœ‰å¼ ç½‘å¡ï¼Œå®¹å™¨å¤–çš„ç½‘å¡è¿åˆ°docker0ç½‘æ¡¥ï¼Œé€šè¿‡è¿™ä¸ªç½‘æ¡¥ï¼Œå®¹å™¨ç›´æ¥å®ç°ç›¸äº’è®¿é—®ã€‚</p>
<p>å¦‚æœä½ ç”¨brctlæŸ¥çœ‹docker0ç½‘æ¡¥ï¼Œä½ ä¼šå‘ç°å®ƒä¸Šé¢è¿ç€ä¸€äº›ç½‘å¡ã€‚å…¶å®è¿™ä¸ªç½‘æ¡¥å’Œ<a href="https://time.geekbang.org/column/article/10742">ç¬¬24è®²</a>ï¼Œå’±ä»¬è‡ªå·±ç”¨brctlåˆ›å»ºçš„ç½‘æ¡¥æ²¡ä»€ä¹ˆä¸¤æ ·ã€‚</p>
<p>é‚£è¿æ¥å®¹å™¨å’Œç½‘æ¡¥çš„é‚£ä¸ªç½‘å¡å’Œè™šæ‹Ÿæœºä¸€æ ·å—ï¼Ÿåœ¨è™šæ‹Ÿæœºåœºæ™¯ä¸‹ï¼Œæœ‰ä¸€ä¸ªè™šæ‹ŸåŒ–è½¯ä»¶ï¼Œé€šè¿‡TUN/TAPè®¾å¤‡è™šæ‹Ÿä¸€ä¸ªç½‘å¡ç»™è™šæ‹Ÿæœºï¼Œä½†æ˜¯å®¹å™¨åœºæ™¯ä¸‹å¹¶æ²¡æœ‰è™šæ‹ŸåŒ–è½¯ä»¶ï¼Œè¿™è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>åœ¨Linuxä¸‹ï¼Œå¯ä»¥åˆ›å»ºä¸€å¯¹veth pairçš„ç½‘å¡ï¼Œä»ä¸€è¾¹å‘é€åŒ…ï¼Œå¦ä¸€è¾¹å°±èƒ½æ”¶åˆ°ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆé€šè¿‡è¿™ä¸ªå‘½ä»¤åˆ›å»ºè¿™ä¹ˆä¸€å¯¹ã€‚</p>
<pre><code>ip link add name veth1 mtu 1500 type veth peer name veth2 mtu 1500
</code></pre>
<p>å…¶ä¸­ä¸€è¾¹å¯ä»¥æ‰“åˆ°docker0ç½‘æ¡¥ä¸Šã€‚</p>
<pre><code>ip link set veth1 master testbr    
ip link set veth1 up
</code></pre>
<p>é‚£å¦ä¸€ç«¯å¦‚ä½•æ”¾åˆ°å®¹å™¨é‡Œå‘¢ï¼Ÿ</p>
<p>ä¸€ä¸ªå®¹å™¨çš„å¯åŠ¨ä¼šå¯¹åº”ä¸€ä¸ªnamespaceï¼Œæˆ‘ä»¬è¦å…ˆæ‰¾åˆ°è¿™ä¸ªnamespaceã€‚å¯¹äºdockeræ¥è®²ï¼Œpidå°±æ˜¯namespaceçš„åå­—ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå‘½ä»¤è·å–ã€‚</p>
<pre><code>docker inspect '--format={{ .State.Pid }}' test
</code></pre>
<p>å‡è®¾ç»“æœä¸º12065ï¼Œè¿™ä¸ªå°±æ˜¯namespaceåå­—ã€‚</p>
<p>é»˜è®¤Dockeråˆ›å»ºçš„ç½‘ç»œnamespaceä¸åœ¨é»˜è®¤è·¯å¾„ä¸‹ ï¼Œip netnsçœ‹ä¸åˆ°ï¼Œæ‰€ä»¥éœ€è¦lnè½¯é“¾æ¥ä¸€ä¸‹ã€‚é“¾æ¥å®Œæ¯•ä»¥åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ip netnså‘½ä»¤æ“ä½œäº†ã€‚</p>
<pre><code>rm -f /var/run/netns/12065    
ln -s /proc/12065/ns/net /var/run/netns/12065
</code></pre>
<p>ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å¦ä¸€ç«¯veth2å¡åˆ°namespaceé‡Œé¢ã€‚</p>
<pre><code>ip link set veth2 netns 12065
</code></pre>
<p>ç„¶åï¼Œå°†å®¹å™¨å†…çš„ç½‘å¡é‡å‘½åã€‚</p>
<pre><code>ip netns exec 12065 ip link set veth2 name eth0
</code></pre>
<p>ç„¶åï¼Œç»™å®¹å™¨å†…ç½‘å¡è®¾ç½®ipåœ°å€ã€‚</p>
<pre><code>ip netns exec 12065 ip addr add 172.17.0.2/24 dev eth0    
ip netns exec 12065 ip link set eth0 up
</code></pre>
<p>ä¸€å°æœºå™¨å†…éƒ¨å®¹å™¨çš„äº’ç›¸è®¿é—®æ²¡æœ‰é—®é¢˜äº†ï¼Œé‚£å¦‚ä½•è®¿é—®å¤–ç½‘å‘¢ï¼Ÿ</p>
<p>ä½ å…ˆæƒ³æƒ³çœ‹æœ‰æ²¡æœ‰æ€è·¯ï¼Ÿå¯¹ï¼Œå°±æ˜¯è™šæ‹Ÿæœºé‡Œé¢çš„æ¡¥æ¥æ¨¡å¼å’ŒNATæ¨¡å¼ã€‚Dockeré»˜è®¤ä½¿ç”¨NATæ¨¡å¼ã€‚NATæ¨¡å¼åˆ†ä¸ºSNATå’ŒDNATï¼Œå¦‚æœæ˜¯å®¹å™¨å†…éƒ¨è®¿é—®å¤–éƒ¨ï¼Œå°±éœ€è¦é€šè¿‡SNATã€‚</p>
<p>ä»å®¹å™¨å†…éƒ¨çš„å®¢æˆ·ç«¯è®¿é—®å¤–éƒ¨ç½‘ç»œä¸­çš„æœåŠ¡å™¨ï¼Œæˆ‘ç”»äº†ä¸€å¼ å›¾ã€‚åœ¨<a href="https://time.geekbang.org/column/article/10742">è™šæ‹Ÿæœº</a>é‚£ä¸€èŠ‚ï¼Œä¹Ÿæœ‰ä¸€å¼ ç±»ä¼¼çš„å›¾ã€‚</p>
<p><img src="https://static001.geekbang.org/resource/image/54/93/5452971c96e8fea33c3f873860e25c93.jpg" alt="" /></p>
<p>åœ¨å®¿ä¸»æœºä¸Šï¼Œæœ‰è¿™ä¹ˆä¸€æ¡iptablesè§„åˆ™ï¼š</p>
<pre><code>-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE
</code></pre>
<p>æ‰€æœ‰ä»å®¹å™¨å†…éƒ¨å‘å‡ºæ¥çš„åŒ…ï¼Œéƒ½è¦åšåœ°å€ä¼ªè£…ï¼Œå°†æºIPåœ°å€ï¼Œè½¬æ¢ä¸ºç‰©ç†ç½‘å¡çš„IPåœ°å€ã€‚å¦‚æœæœ‰å¤šä¸ªå®¹å™¨ï¼Œæ‰€æœ‰çš„å®¹å™¨å…±äº«ä¸€ä¸ªå¤–ç½‘çš„IPåœ°å€ï¼Œä½†æ˜¯åœ¨conntrackè¡¨ä¸­ï¼Œè®°å½•ä¸‹è¿™ä¸ªå‡ºå»çš„è¿æ¥ã€‚</p>
<p>å½“æœåŠ¡å™¨è¿”å›ç»“æœçš„æ—¶å€™ï¼Œåˆ°è¾¾ç‰©ç†æœºï¼Œä¼šæ ¹æ®conntrackè¡¨ä¸­çš„è§„åˆ™ï¼Œå–å‡ºåŸæ¥çš„ç§ç½‘IPï¼Œé€šè¿‡DNATå°†åœ°å€è½¬æ¢ä¸ºç§ç½‘IPåœ°å€ï¼Œé€šè¿‡ç½‘æ¡¥docker0å®ç°å¯¹å†…çš„è®¿é—®ã€‚</p>
<p>å¦‚æœåœ¨å®¹å™¨å†…éƒ¨å±äºä¸€ä¸ªæœåŠ¡ï¼Œä¾‹å¦‚éƒ¨ç½²ä¸€ä¸ªç½‘ç«™ï¼Œæä¾›ç»™å¤–éƒ¨è¿›è¡Œè®¿é—®ï¼Œéœ€è¦é€šè¿‡Dockerçš„ç«¯å£æ˜ å°„æŠ€æœ¯ï¼Œå°†å®¹å™¨å†…éƒ¨çš„ç«¯å£æ˜ å°„åˆ°ç‰©ç†æœºä¸Šæ¥ã€‚</p>
<p>ä¾‹å¦‚å®¹å™¨å†…éƒ¨ç›‘å¬80ç«¯å£ï¼Œå¯ä»¥é€šDocker runå‘½ä»¤ä¸­çš„å‚æ•°-p 10080:80ï¼Œå°†ç‰©ç†æœºä¸Šçš„10080ç«¯å£å’Œå®¹å™¨çš„80ç«¯å£æ˜ å°„èµ·æ¥ï¼Œ å½“å¤–éƒ¨çš„å®¢æˆ·ç«¯è®¿é—®è¿™ä¸ªç½‘ç«™çš„æ—¶å€™ï¼Œé€šè¿‡è®¿é—®ç‰©ç†æœºçš„10080ç«¯å£ï¼Œå°±èƒ½è®¿é—®åˆ°å®¹å™¨å†…çš„80ç«¯å£äº†ã€‚</p>
<p><img src="https://static001.geekbang.org/resource/image/49/bb/49bb6b2a30fe76b124182980da935ebb.jpg" alt="" /></p>
<p>Dockeræœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯é€šè¿‡ä¸€ä¸ªè¿›ç¨‹<strong>docker-proxy</strong>çš„æ–¹å¼ï¼Œç›‘å¬10080ï¼Œè½¬æ¢ä¸º80ç«¯å£ã€‚</p>
<pre><code>/usr/bin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 10080 -container-ip 172.17.0.2 -container-port 80
</code></pre>
<p>å¦å¤–ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡<strong>DNAT</strong>æ–¹å¼ï¼Œåœ¨-A PREROUTINGé˜¶æ®µåŠ ä¸€ä¸ªè§„åˆ™ï¼Œå°†åˆ°ç«¯å£10080çš„DNATç§°ä¸ºå®¹å™¨çš„ç§æœ‰ç½‘ç»œã€‚</p>
<pre><code>-A DOCKER -p tcp -m tcp --dport 10080 -j DNAT --to-destination 172.17.0.2:80
</code></pre>
<p>å¦‚æ­¤å°±å¯ä»¥å®ç°å®¹å™¨å’Œç‰©ç†ç½‘ç»œä¹‹é—´çš„äº’é€šäº†ã€‚</p>
<h2>å°ç»“</h2>
<p>å¥½äº†ï¼Œè¿™ä¸€èŠ‚å°±åˆ°è¿™é‡Œäº†ï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ã€‚</p>
<ul>
<li>
<p>å®¹å™¨æ˜¯ä¸€ç§æ¯”è™šæ‹Ÿæœºæ›´åŠ è½»é‡çº§çš„éš”ç¦»æ–¹å¼ï¼Œä¸»è¦é€šè¿‡namespaceå’ŒcgroupæŠ€æœ¯è¿›è¡Œèµ„æºçš„éš”ç¦»ï¼Œnamespaceç”¨äºè´Ÿè´£çœ‹èµ·æ¥éš”ç¦»ï¼Œcgroupç”¨äºè´Ÿè´£ç”¨èµ·æ¥éš”ç¦»ã€‚</p>
</li>
<li>
<p>å®¹å™¨ç½‘ç»œè¿æ¥åˆ°ç‰©ç†ç½‘ç»œçš„æ–¹å¼å’Œè™šæ‹Ÿæœºå¾ˆåƒï¼Œé€šè¿‡æ¡¥æ¥çš„æ–¹å¼å®ç°ä¸€å°ç‰©ç†æœºä¸Šçš„å®¹å™¨è¿›è¡Œç›¸äº’è®¿é—®ï¼Œå¦‚æœè¦è®¿é—®å¤–ç½‘ï¼Œæœ€ç®€å•çš„æ–¹å¼è¿˜æ˜¯é€šè¿‡NATã€‚</p>
</li>
</ul>
<p>æœ€åï¼Œç»™ä½ ç•™ä¸¤ä¸ªæ€è€ƒé¢˜ï¼š</p>
<ol>
<li>
<p>å®¹å™¨å†…çš„ç½‘ç»œå’Œç‰©ç†æœºç½‘ç»œå¯ä»¥ä½¿ç”¨NATçš„æ–¹å¼ç›¸äº’è®¿é—®ï¼Œå¦‚æœè¿™ç§æ–¹å¼ç”¨äºéƒ¨ç½²åº”ç”¨ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p>
</li>
<li>
<p>å’Œè™šæ‹Ÿæœºä¸€æ ·ï¼Œä¸åŒç‰©ç†æœºä¸Šçš„å®¹å™¨éœ€è¦ç›¸äº’é€šä¿¡ï¼Œä½ çŸ¥é“å®¹å™¨æ˜¯æ€ä¹ˆåšåˆ°è¿™ä¸€ç‚¹å—ï¼Ÿ</p>
</li>
</ol>
<p>æˆ‘ä»¬çš„ä¸“æ æ›´æ–°åˆ°ç¬¬29è®²ï¼Œä¸çŸ¥ä½ æŒæ¡å¾—å¦‚ä½•ï¼Ÿæ¯èŠ‚è¯¾åæˆ‘ç•™çš„æ€è€ƒé¢˜ï¼Œä½ éƒ½æœ‰æ²¡æœ‰è®¤çœŸæ€è€ƒï¼Œå¹¶åœ¨ç•™è¨€åŒºå†™ä¸‹ç­”æ¡ˆå‘¢ï¼Ÿæˆ‘ä¼šä»<strong>å·²å‘å¸ƒçš„æ–‡ç« ä¸­é€‰å‡ºä¸€æ‰¹è®¤çœŸç•™è¨€çš„åŒå­¦</strong>ï¼Œèµ é€<span class="orange">å­¦ä¹ å¥–åŠ±ç¤¼åˆ¸</span>å’Œæˆ‘æ•´ç†çš„<span class="orange">ç‹¬å®¶ç½‘ç»œåè®®çŸ¥è¯†å›¾è°±</span>ã€‚</p>
<p>æ¬¢è¿ä½ ç•™è¨€å’Œæˆ‘è®¨è®ºã€‚è¶£è°ˆç½‘ç»œåè®®ï¼Œæˆ‘ä»¬ä¸‹æœŸè§ï¼</p>
<p><img src="https://static001.geekbang.org/resource/image/b5/fb/b5bc14cb81d3630919fee94a512cc3fb.jpg" alt="" /></p>

                    </div>
                </div>

            </div>
            <div data-v-87ffcada="" class="article-comments pd"><h2 data-v-87ffcada=""><span
                    data-v-87ffcada="">ç²¾é€‰ç•™è¨€</span></h2>
                <ul data-v-87ffcada="">
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/f7/c4/bd7dd30a.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å°æ–‡</span>
                            </div>
                            <div class="bd">æˆ‘æ€ä¹ˆæ„Ÿè§‰å¹²è¿ç»´çš„æ‰èƒ½ç†è§£è¿™ä¹ˆæ·± <br></div>
                            <span class="time">2018-08-14 19:06</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/ab/2a/f3207127.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è´¾é¹</span>
                            </div>
                            <div class="bd">é—®é¢˜1ï¼Œç”±äºnatå¯¼è‡´ç½‘ç»œæ€§èƒ½æœ‰æŸè€—ï¼Œè€Œä¸”ç‰©ç†æœºç«¯å£è¢«å ç”¨ï¼Œå½“å®¹å™¨å¤šçš„æ—¶å€™å¯¹äºç‰©ç†æœºç«¯å£çš„å ç”¨æ›´åŠ æ˜æ˜¾<br>é—®é¢˜2ï¼Œè·¨ç‰©ç†æœºé—´çš„å®¹å™¨é€šä¿¡ï¼Œä¸»è¦çš„æ€è·¯æ˜¯æ„é€ æ‰å¹³åŒ–ç½‘ç»œæ¨¡å‹ï¼Œä¸»è¦æœ‰cnmå’Œcniæ¨¡å‹ï¼Œæ”¯æŒå¾ˆå¤šç½‘ç»œæ’ä»¶å®ç°é›†ç¾¤å†…çš„å®¹å™¨åªæœ‰å”¯ä¸€çš„IPã€‚è¿™äº›æ’ä»¶å¾ˆå¤šï¼Œæ¯”å¦‚flannel macvlan<br>å¦å¤–æ±‚ç½‘ç»œæ¢³ç†å›¾<br>ä¸åˆ†äº«è¿˜ä¸èƒ½ç•™è¨€å—ï¼Ÿ <br></div>
                            <span class="time">2018-07-25 20:15</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/52/c3/896f3410.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">kissingers</span>
                            </div>
                            <div class="bd">è€å¸ˆï¼Œå‘½åç©ºé—´ï¼ˆnamespaceï¼‰é…åšrouter è¿™æ®µï¼ŒOVS&#47;Bridge çš„ç«¯å£èƒ½ç›´æ¥æ”¾åˆ°namespace é‡Œé¢ ï¼Ÿä¸ç”¨veth pair ï¼Ÿ   <br></div>
                            <span class="time">2018-11-13 19:40</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/7a/5e/9431165a.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">spdia</span>
                            </div>
                            <div class="bd">è¿™ç« æ¯”è¾ƒéš¾ï¼Œä¸»è¦æ˜¯æˆ‘å¯¹ip netns ä¸ç†Ÿæ‚‰ï¼Œè¿˜è¦å¤šçœ‹å‡ éï¼Œå†ä¸Šè™šæ‹Ÿæœºä¸Šæ“ä½œå‡ éæ‰è¡Œã€‚ <br></div>
                            <span class="time">2018-09-08 20:32</span>
                            
                            <div class="reply">
                                <div class="reply-hd"><span>ä½œè€…å›å¤</span></div>
                                <p class="reply-content">é¼“åŠ±æ“ä½œ</p>
                                <p class="reply-time">2018-09-09 22:38</p>
                            </div>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/b6/11/e8506a04.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å°å®‡å®™</span>
                            </div>
                            <div class="bd">éƒ¨ç½²åº”ç”¨è¦è€ƒè™‘æœåŠ¡å‘ç°é—®é¢˜ï¼Œå°±æ˜¯å¤–éƒ¨çš„clientæ€ä¹ˆæ‰¾åˆ°è¿™ä¸ªåº”ç”¨å¹¶è®¿é—®ï¼Œè¿˜æœ‰å°±æ˜¯ä¸€èˆ¬åº”ç”¨éƒ½æ˜¯é›†ç¾¤åŒ–éƒ¨ç½²ï¼Œè¿˜æ¶‰åŠåˆ°è´Ÿè½½çš„å‡è¡¡é—®é¢˜ï¼Œé€šè¿‡NATçš„æ–¹å¼ï¼Œè¦æš´éœ²å®¿ä¸»æœºçš„ipå’Œç«¯å£ï¼Œè¿›è¡Œç«¯å£æ˜ å°„å’Œipåœ°å€è½¬æ¢ï¼Œä¸€æ–¹é¢æ¶ˆè€—å¾ˆå¤šå®è´µçš„ä¸»æœºçš„ç½‘ç»œèµ„æºï¼Œå¦ä¸€æ–¹é¢æœåŠ¡æ³¨å†Œå’ŒæœåŠ¡å‘ç°ä¹Ÿä¼šå˜å¤æ‚ã€‚ <br></div>
                            <span class="time">2018-08-27 12:39</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/23/5b/dead073b.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Jay</span>
                            </div>
                            <div class="bd">è¯·é—®ä¸‹docker()æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿåˆ†äº«æ‰èƒ½ç•™è¨€ï¼Ÿ <br></div>
                            <span class="time">2018-08-03 19:17</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/de/f3/6b47cedf.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å¤œé£</span>
                            </div>
                            <div class="bd">çœ‹äº†ä¸€éï¼Œæ²¡çœ‹æ˜ç™½ï¼Œæˆ‘å¤šå»çœ‹å‡ é <br></div>
                            <span class="time">2018-07-30 00:29</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/11/ab/2a/f3207127.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">è´¾é¹</span>
                            </div>
                            <div class="bd">é—®é¢˜1ï¼Œnatä¼šå¯¼è‡´æ€§èƒ½æŸè€—<br>é—®é¢˜2ï¼Œä¸»è¦æ˜¯é€šè¿‡æ„é€ æ‰å¹³ç½‘ç»œï¼Œk8sä¸»è¦æ˜¯cniå’Œcnmç½‘ç»œæ¨¡å‹ï¼Œæ”¯æŒå¾ˆå¤šç½‘ç»œæ’ä»¶æ¥å®ç°ï¼Œæ¯”å¦‚flannelï¼Œmacvlanç­‰ï¼Œä»è€Œè®©ä¸åŒç‰©ç†æœºä¸Šçš„å®¹å™¨æœ‰ä¸åŒçš„IP <br></div>
                            <span class="time">2018-07-25 19:59</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/10/09/42/b7a406c9.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">Hurt</span>
                            </div>
                            <div class="bd">è€å¸ˆæˆ‘åˆæ¥ç­¾åˆ°äº† ä½ è¿˜è®°å¾—æˆ‘å—ğŸ˜€ <br></div>
                            <span class="time">2018-07-23 19:39</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/7c/16/38c07a04.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">_CountingStars</span>
                            </div>
                            <div class="bd">çªç„¶æƒ³èµ·æ¥ä¸€ä¸ªé—®é¢˜ natç½‘ç»œ è™½ç„¶èƒ½é€šä¿¡ ä½†æ˜¯åˆ«äººçœ‹åˆ°çš„ipæ˜¯ä½ è¢«natä¹‹åçš„ip ä¾‹å¦‚æœåŠ¡æ³¨å†Œè¿™æ ·çš„åŠŸèƒ½ ä¼šå¯¼è‡´ æœåŠ¡æ³¨å†Œè·å–çš„ip æ˜¯ä½ natä¹‹åçš„ip è€Œä¸æ˜¯ä½ çœŸå®çš„ip <br></div>
                            <span class="time">2018-07-23 13:51</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/a9/90/0c5ed3d9.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">é¢‡å¿’å¦¥</span>
                            </div>
                            <div class="bd">ç¬¬äºŒä¸ªé—®é¢˜dockerç”¨çš„æ˜¯macvlan <br></div>
                            <span class="time">2018-07-23 08:24</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/7c/16/38c07a04.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">_CountingStars</span>
                            </div>
                            <div class="bd">1.ä½¿ç”¨natéƒ¨ç½²æœåŠ¡ å¯èƒ½ä¼šæœ‰ç½‘ç»œæ€§èƒ½é—®é¢˜<br>2.å®¹å™¨è·¨èŠ‚ç‚¹é€šä¿¡ å¯ä»¥ä½¿ç”¨ bgp ä¸»æœºè·¯ç”± vxlan ç­‰æ–¹å¼ <br></div>
                            <span class="time">2018-07-23 08:24</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/7c/16/38c07a04.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">_CountingStars</span>
                            </div>
                            <div class="bd">1.ä½¿ç”¨natéƒ¨ç½²æœåŠ¡ å¯èƒ½ä¼šæœ‰ç½‘ç»œæ€§èƒ½é—®é¢˜<br>2.å®¹å™¨è·¨èŠ‚ç‚¹é€šä¿¡ å¯ä»¥ä½¿ç”¨ bgp ä¸»æœºè·¯ç”± vxlan ç­‰æ–¹å¼ <br></div>
                            <span class="time">2018-07-23 08:23</span>
                            
                        </div>
                    </li>
                    
                    <li data-v-87ffcada="" class="comment-item"><img
                            src="https://static001.geekbang.org/account/avatar/00/0f/eb/f6/ec7971f4.jpg" class="avatar">
                        <div class="info">
                            <div class="hd"><span class="username">å›ºæ€Uç›˜</span>
                            </div>
                            <div class="bd">åŠæ—¶çš„æ–‡ç« ï¼Œå¤šè°¢è€å¸ˆã€‚ <br></div>
                            <span class="time">2018-07-23 07:33</span>
                            
                        </div>
                    </li>
                    


                </ul>
            </div>
        </div>
    </div>
</div>
</body>
</html>