# 重点！！！

建立一个上下文，让用户上传的代码，修改的代码，跟最终使用的组件，使用同一个上下文，就可以达成一致性了

***

# 关于codeless项目
## code/
### 生成文件对象
* 把本地模板创建成对象

### 上传
* 把本地模板对象，这个对象中有content（文件的内容）传到oss中，得到一个url,指向OSS中的文件
* 数据库对象中只对文件对象。把对象上传到数据库

### 下载
* 下载数据库中的对象，具体文件内容从url指向的OSS中得到

## ui/
### react项目加载
* 直接网络请求加载组件

### 怎么做到的下载后的组件通信?
  
  使用状态机(stateMachine)与观察者模式(Emiter) 
  
  交互提前在UI中写完了，拉取下来的文件对象只负责了渲染


## runtime/
运行时用户编辑代码，编辑完成之后由save方法把文件对象再次上传OSS


## svc/

* 把用户编辑完的代码下载到本地，打包。
* 打包后的代码再次上传到OSS，把上传后获得的地址放到对象中即可
* UI层就可以使用打包后的代码了


## UI层 怎么使用打包后的代码呢？
  // 对象有toJSON 和 fromJSON方法，
  把数据库中的json拿下来，fromJSON()转乘对象,从对象里拿出指向文件的url,下载文件，使用`eval`执行！NB
  ！更NB的是那亿点点细节

## @monaco-editor
一个可以在web端显示编辑器的工具，微软开发的，贼特么NB


# 思考： 组件拆分，分别上传至服务器，前端直接线上拉取组件下来使用

> DSL领域化后的组件是可以把领域化的文件上传到服务器上，然后拉取文件，渲染成组件的

## 这么做有什么好处？

  * 可以根据后台返回的组件链接，直接拉取不一样的组件，动态变化
  * 组件可以单独打包、上线
  * 组件复用应该不算好处- 可以做成组件库引用好直接打包上线

## 有什么坏处呢？

  * 组件由线上拉取，有时间成本

## 所以：

是不是可以部分核心组件，直接拉取线上的，项目中做最基本的搭建

## 怎么做？直接拉取下来的代码能不能用呢？**可以先用本地文件模拟一下！**

### 上传- 传什么？

  组件文件夹，拥有样式与组件文件，整体上传，
  使用codeless的逻辑，文件上传至OSS，获取到url把对象上传至数据库
  组件中使用到的库，在项目中都已经加载好了

### 下载怎么用
  下载到的是一个对象，然后根据对象的url属性再下载文件内容，**文件内容能否直接用在项目中呢？**
  拉取下来的应该是一个DSL文件，然后根据文件内容渲染组件
  `eval`!真特么NB
### 怎么通信，需要用到emiter，自己写一个，发个包也行
 
  交互与通信写在项目中即可，拉取的文件只负责渲染组件